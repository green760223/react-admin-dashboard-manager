import{g as C,r as l,a as o,j as e,F as n,I as g,m as w,B as d,e as I,S as F}from"./index-20e9fe8d.js";import{F as v}from"./Form-1b096171.js";import{M as S}from"./index-b7ce58c4.js";import{_ as L}from"./index-81b5abb8.js";import{S as k}from"./index-6bbec992.js";import{T}from"./Table-1d5dd19f.js";import"./dynamicCSS-6c748332.js";import"./useBreakpoint-9dd5e0e1.js";function _(i){const[a]=C(),[m,p]=l.useState("create"),[c,u]=l.useState(!1),[x,h]=l.useState([]),[f,j]=l.useState([]);l.useEffect(()=>{b()},[]);const y=async()=>{const r=await o.getDeptList();console.log(r),h(r)},b=async()=>{const r=await o.getAllUserList();j(r)};l.useImperativeHandle(i.mRef,()=>({open:t}));const t=(r,N)=>{p(r),u(!0),y(),N&&a.setFieldsValue(N)},s=async()=>{await a.validateFields()&&(m==="create"?await o.createDept(a.getFieldsValue()):await o.editDept(a.getFieldsValue()),w.success("操作成功"),D(),i.update())},D=()=>{u(!1),a.resetFields()};return e.jsx(S,{title:m==="create"?"創建部門":"編輯部門",width:800,open:c,okText:"確定",cancelText:"取消",onOk:s,onCancel:D,children:e.jsxs(n,{form:a,labelAlign:"right",labelCol:{span:4},children:[e.jsx(n.Item,{label:"部門ID",name:"_id",hidden:!0,children:e.jsx(g,{disabled:!0})}),e.jsx(n.Item,{label:"上級部門",name:"parentId",children:e.jsx(L,{placeholder:"請選擇上級部門",allowClear:!0,treeDefaultExpandAll:!0,fieldNames:{label:"deptName",value:"_id"},treeData:x})}),e.jsx(n.Item,{label:"部門名稱",name:"deptName",rules:[{required:!0,message:"請輸入部門名稱"}],children:e.jsx(g,{placeholder:"請輸入部門名稱"})}),e.jsx(n.Item,{label:"負責人",name:"userName",rules:[{required:!0,message:"請選擇負責人"}],children:e.jsx(k,{children:f.map(r=>e.jsx(k.Option,{value:r.userName,children:r.userName},r._id))})})]})})}function M(){const[i]=v.useForm(),a=l.useRef(),[m,p]=l.useState([]),c=async()=>{const t=await o.getDeptList(i.getFieldsValue());p(t)},u=()=>{var t;(t=a.current)==null||t.open("create")},x=()=>{i.resetFields()},h=t=>{var s;(s=a.current)==null||s.open("edit",t)},f=t=>{var s;(s=a.current)==null||s.open("create",{parentId:t})},j=async t=>{S.confirm({title:"確認",content:"確認刪除後數據將無法恢復",onOk(){y(t)}})},y=async t=>{await o.deleteDept({_id:t}),w.success("刪除成功"),c()};l.useEffect(()=>{c()},[]);const b=[{title:"部門名稱",dataIndex:"deptName",key:"deptName",width:200},{title:"負責人",dataIndex:"userName",key:"userName",width:150},{title:"更新時間",dataIndex:"updateTime",key:"updateTime",render(t){return I(t)}},{title:"創立時間",dataIndex:"createTime",key:"createTime",render(t){return I(t)}},{title:"操作",key:"action",width:200,render(t,s){return e.jsxs(F,{children:[e.jsx(d,{type:"text",onClick:()=>f(s._id),children:"新增"}),e.jsx(d,{type:"text",onClick:()=>h(s),children:"編輯"}),e.jsx(d,{type:"text",danger:!0,onClick:()=>j(s._id),children:"刪除"})]})}}];return e.jsxs("div",{children:[e.jsxs(n,{className:"search-form",layout:"inline",form:i,children:[e.jsx(n.Item,{label:"部門名稱",name:"deptName",children:e.jsx(g,{placeholder:"部門名稱"})}),e.jsxs(n.Item,{children:[e.jsx(d,{type:"primary",className:"mr10",onClick:c,children:"搜尋"}),e.jsx(d,{type:"default",onClick:x,children:"重置"})]})]}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrapper",children:[e.jsx("div",{className:"title",children:"部門列表"}),e.jsx("div",{className:"action",children:e.jsx(d,{type:"primary",onClick:u,children:"新增"})})]}),e.jsx(T,{bordered:!0,rowKey:"_id",columns:b,dataSource:m,pagination:!1})]}),e.jsx(_,{mRef:a,update:c})]})}export{M as default};

import{g as C,r,j as e,F as n,I as i,h as F,a as u,m as S,B as o,e as T,S as N}from"./index-67e56664.js";import{F as w}from"./Form-d7666502.js";import{M as k}from"./index-4acbff7e.js";import{_ as M}from"./index-dc5f151d.js";import{_ as s,T as _}from"./Table-cce7256e.js";import{_ as V}from"./index-58609825.js";import{S as v}from"./index-ea699173.js";import"./dynamicCSS-6c748332.js";import"./useBreakpoint-2ff475ea.js";function D(d){const[l]=C(),[m,p]=r.useState("create"),[c,h]=r.useState(!1),[j,y]=r.useState([]),f=async()=>{const t=await u.getMenuList();y(t)};r.useImperativeHandle(d.mRef,()=>({open:I}));const I=(t,a)=>{p(t),h(!0),f(),a&&l.setFieldsValue(a)},b=async()=>{await l.validateFields()&&(m==="create"?await u.createMenu(l.getFieldsValue()):await u.editMenu(l.getFieldsValue()),S.success("操作成功"),x(),d.update())},x=()=>{h(!1),l.resetFields()};return e.jsx(k,{title:m==="create"?"創建菜單":"編輯菜單",width:800,open:c,okText:"確定",cancelText:"取消",onOk:b,onCancel:x,children:e.jsxs(n,{form:l,labelAlign:"right",labelCol:{span:4},initialValues:{menuType:1,menuState:1},children:[e.jsx(n.Item,{label:"菜單ID",name:"_id",hidden:!0,children:e.jsx(i,{disabled:!0})}),e.jsx(n.Item,{label:"上級菜單",name:"parentId",children:e.jsx(M,{placeholder:"請選擇上級菜單",allowClear:!0,treeDefaultExpandAll:!0,fieldNames:{label:"menuName",value:"_id"},treeData:j})}),e.jsx(n.Item,{label:"菜單類型",name:"menuType",children:e.jsxs(s.Group,{children:[e.jsx(s,{value:1,children:"菜單"}),e.jsx(s,{value:2,children:"按鈕"}),e.jsx(s,{value:3,children:"頁面"})]})}),e.jsx(n.Item,{label:"菜單名稱",name:"menuName",rules:[{required:!0,message:"請輸入菜單名稱"}],children:e.jsx(i,{placeholder:"請輸入菜單名稱"})}),e.jsx(n.Item,{noStyle:!0,shouldUpdate:!0,children:()=>l.getFieldValue("menuType")===2?e.jsx(n.Item,{label:"權限標示",name:"menuCode",children:e.jsx(i,{placeholder:"請輸入權限標示"})}):e.jsxs(e.Fragment,{children:[e.jsx(n.Item,{label:"菜單圖標",name:"icon",children:e.jsx(i,{placeholder:"請輸入菜單圖標"})}),e.jsx(n.Item,{label:"路由地址",name:"path",children:e.jsx(i,{placeholder:"請輸入路由地址"})})]})}),e.jsx(n.Item,{label:"組件名稱",name:"component",children:e.jsx(i,{placeholder:"請輸入組件名稱"})}),e.jsx(n.Item,{label:"排序",name:"orderBy",tooltip:{title:"排序值越大越靠後",icon:e.jsx(F,{rev:void 0})},children:e.jsx(V,{placeholder:"請輸入排序值"})}),e.jsx(n.Item,{label:"菜單狀態",name:"menuState",children:e.jsxs(s.Group,{children:[e.jsx(s,{value:1,children:"啟用"}),e.jsx(s,{value:2,children:"停用"})]})})]})})}function H(){const[d]=w.useForm(),l=r.useRef(),[m,p]=r.useState([]),c=async()=>{const t=await u.getMenuList(d.getFieldsValue());p(t)},h=()=>{var t;(t=l.current)==null||t.open("create",{orderBy:m.length})},j=()=>{d.resetFields()},y=t=>{var a;(a=l.current)==null||a.open("edit",t)},f=t=>{var a,g;(g=l.current)==null||g.open("create",{parentId:t._id,orderBy:(a=t.children)==null?void 0:a.length})},I=async t=>{let a="";t.menuType=="1"?a="菜單":t.menuType=="2"?a="按鈕":t.menuType=="3"&&(a="頁面"),k.confirm({title:"確認",content:`確認刪除${a}後數據將無法恢復`,onOk(){b(t._id)}})},b=async t=>{await u.deleteMenu({_id:t}),S.success("刪除成功"),c()};r.useEffect(()=>{c()},[]);const x=[{title:"菜單名稱",dataIndex:"menuName",key:"menuName"},{title:"菜單圖標",dataIndex:"icon",key:"icon"},{title:"菜單類型",dataIndex:"menuType",key:"menuType",render(t){return{1:"菜單",2:"按鈕",3:"頁面"}[t]}},{title:"權限標示",dataIndex:"menuCode",key:"menuCode"},{title:"路由地址",dataIndex:"path",key:"path"},{title:"組建名稱",dataIndex:"component",key:"component"},{title:"創建時間",dataIndex:"createTime",key:"createTime",render(t){return T(t)}},{title:"操作",key:"action",width:200,render(t,a){return e.jsxs(N,{children:[e.jsx(o,{type:"text",onClick:()=>f(a),children:"新增"}),e.jsx(o,{type:"text",onClick:()=>y(a),children:"編輯"}),e.jsx(o,{type:"text",danger:!0,onClick:()=>I(a),children:"刪除"})]})}}];return e.jsxs("div",{children:[e.jsxs(n,{className:"search-form",layout:"inline",form:d,initialValues:{menuState:1},children:[e.jsx(n.Item,{label:"菜單名稱",name:"menuName",children:e.jsx(i,{placeholder:"菜單名稱"})}),e.jsx(n.Item,{label:"菜單狀態",name:"menuState",children:e.jsxs(v,{style:{width:100},children:[e.jsx(v.Option,{value:1,children:"正常"}),e.jsx(v.Option,{value:2,children:"停用"})]})}),e.jsxs(n.Item,{children:[e.jsx(o,{type:"primary",className:"mr10",onClick:c,children:"搜尋"}),e.jsx(o,{type:"default",onClick:j,children:"重置"})]})]}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrapper",children:[e.jsx("div",{className:"title",children:"菜單列表"}),e.jsx("div",{className:"action",children:e.jsx(o,{type:"primary",onClick:h,children:"新增"})})]}),e.jsx(_,{bordered:!0,rowKey:"_id",columns:x,dataSource:m,pagination:!1})]}),e.jsx(D,{mRef:l,update:c})]})}export{H as default};
